<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Document</title>
    <link rel="stylesheet" href="/public/css/style.css">
</head>
<body>
    <div class="w-64 h-screen bg-white shadow-xl text-white fixed">
        <div class="p-4 text-black">
            <div class="flex items-center space-x-2 my-5">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-11 w-11" fill="black" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z M4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                </svg>
                <div id="user-info">
                    <div id="id-user-display"></div>
                    <div id="username-display" class="font-bold text-xl"></div>
                </div>
            </div>
            <h1 class="font-bold text-xl text-center text-[#00716A]">Dokumen</h1>
        </div>
    </div>

    <div class="flex-1 ml-64 p-8">
        <div class="max-w-4xl mx-auto flex flex-col border-2 rounded-2xl p-4">
            <form id="upload-form" enctype="multipart/form-data">
            <!-- File Upload Area -->
            <div class="flex justify-center">
              <label for="file_dokumen" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-100 hover:bg-gray-200">
                <div id="upload-content" class="flex flex-col items-center justify-center pt-5 pb-6">
                  <!-- SVG and Text -->
                  <svg class="w-8 h-8 mb-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                    <!-- SVG Path -->
                  </svg>
                  <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Pilih file</span></p>
                  <p class="text-xs text-gray-500">PDF (MAX. 10MB)</p>
                </div>
                <input id="file_dokumen" type="file" name="file_dokumen" accept=".pdf" required class="hidden" />
              </label>
            </div>

            <!-- Input Fields and Submit Button Inside the Container -->
            <div class="mt-8">
                <!-- Container Input Fields -->
                <div class="flex flex-wrap -mx-2">
                    <!-- Input 1 -->
                    <div class="w-full md:w-1/2 px-2 mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="input1">
                            Nomor Dokumen
                        </label>
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700" 
                            id="nomor_dokumen"
                            name="nomor_dokumen"
                            type="text"
                            placeholder="Nomor Dokumen"
                            required
                        />
                    </div>
                    <!-- Input 2 -->
                    <div class="w-full md:w-1/2 px-2 mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="input1">
                            Tanggal Pengajuan
                        </label>
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="tgl_pengajuan"
                            name="tgl_pengajuan"
                            type="date"
                            placeholder="Masukkan input 1"
                            required
                        />
                    </div>
                    <div class="w-full md:w-1/2 px-2 mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="input1">
                            Judul Dokumen
                        </label>
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="judul_dokumen"
                            name="judul_dokumen"
                            type="text"
                            placeholder="Judul Dokumen"
                            required
                        />
                    </div>
                    <div class="w-full md:w-1/2 px-2 mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="input1">
                            Deadline
                        </label>
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="tgl_deadline"
                            name="tgl_deadline"
                            type="date"
                            placeholder="Masukkan Tanggal Deadline"
                        />
                    </div>
                    
                        <div class="w-full md:w-1/2 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="transaksi">
                                Transaksi
                            </label>
                            <select id="transaksi" name="transaksi" class="shadow border rounded w-full py-2 px-3 text-gray-700">
                                <option value="cuti">Pengajuan Cuti</option>
                                <option value="proposal">Pengajuan Proposal</option>
                            </select>
                        </div>
                        <div class="w-full md:w-1/2 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="masterflow">
                                Masterflow
                            </label>
                            <select id="masterflow" name="masterflow" class="shadow border rounded w-full py-2 px-3 text-gray-700">
                                <option value="masterflow">Masterflow</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                    
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="nama_approval_1">
                                Nama Approval 
                            </label>
                            <input
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="nama_approval_1"
                                name="nama_approval_1"
                                type="text"
                                placeholder="Masukkan Nama Approval 1"
                                required
                            />
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="email_approval_1">
                                Email 
                            </label>
                            <input
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="email_approval_1"
                                name="email_approval_1"
                                type="email"
                                placeholder="Masukkan Email Approval 1"
                                required
                            />
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="email_approval_1">
                                Jabatan 
                            </label>
                            <input
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="jabatan_approval_1"
                                name="jabatan_approval_1"
                                type="text"
                                placeholder="Masukkan Jabatan"
                                
                            />
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="urutan_approval_1">
                                Urutan 
                            </label>
                            <input
                                class="shadow border rounded w-1/4 py-2 px-3 text-gray-700"
                                id="urutan_approval_1"
                                name="urutan_approval_1"
                                type="number"
                                value="1"
                                readonly
                            />
                        
                            <button
                            type="button"
                            id="add-approval"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2"
                        >
                            +
                        </button>
                    </div>
                    <div class="mb-2">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="jenis_group_1">
                            Jenis Group
                        </label>
                        <select
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="jenis_group_1"
                            name="jenis_group_1"
                            required
                        >
                            <option value="all" selected>Semua harus menyetujui</option>
                            <option value="any">Salah satu saja</option>
                        </select>
                    </div>

                        <div id="approval-container-1"></div>
                    

                    <!-- Approval 2 -->
                    <div class="w-full flex flex-wrap px-2 mb-4">
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="nama_approval_2">
                            </label>
                            <input
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="nama_approval_2"
                                name="nama_approval_2"
                                type="text"
                                placeholder="Masukkan Nama Approval 2"
                                
                            />
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="email_approval_2">
                                
                            </label>
                            <input
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="email_approval_2"
                                name="email_approval_2"
                                type="email"
                                placeholder="Masukkan Email Approval 2"
                                
                            />
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="jabatan_approval_2">
                                
                            </label>
                            <input
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="jabatan_approval_2"
                                name="jabatan_approval_2"
                                type="text"
                                placeholder="Masukkan Jabatan"
                                
                            />
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4 flex items-center">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="urutan_approval_2">
                                
                            </label>
                            <input
                                class="shadow border rounded w-1/4 py-2 px-3 text-gray-700"
                                id="urutan_approval_2"
                                name="urutan_approval_2"
                                type="number"
                                value="2"
                                readonly
                            />
                            <button
                            type="button"
                            id="add-approval-2"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2"
                        >
                            +
                        </button>
                        
                        </div>
                        <div class="mb-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="jenis_group_2">
                                Jenis Group
                            </label>
                            <select
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="jenis_group_2"
                                name="jenis_group_2"
                                required
                            >
                                <option value="all" selected>Semua harus menyetujui</option>
                                <option value="any">Salah satu saja</option>
                            </select>
                        </div>

                        <div id="approval-container-2"></div>
                    </div>

                    <!-- Approval 3 -->

                    <div class="w-full flex flex-wrap px-2 mb-4">
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="nama_approval_3">
                                
                            </label>
                            <input
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="nama_approval_3"
                                name="nama_approval_3"
                                type="text"
                                placeholder="Masukkan Nama Approval 3"
                                
                            />
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="email_approval_3">
                                
                            </label>
                            <input
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="email_approval_3"
                                name="email_approval_3"
                                type="email"
                                placeholder="Masukkan Email Approval 3"
                                
                            />
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="jabatan_approval_3">
                                
                            </label>
                            <input
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="jabatan_approval_3"
                                name="jabatan_approval_3"
                                type="text"
                                placeholder="Masukkan Jabatan"
                                
                            />
                        </div>
                        <div class="w-full md:w-1/3 px-2 mb-4 flex">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="urutan_approval_3">
                                
                            </label>
                            <input
                                class="shadow border rounded w-1/4 py-2 px-3 text-gray-700"
                                id="urutan_approval_3"
                                name="urutan_approval_3"
                                type="number"
                                value="3"
                                readonly
                            />
                            <button
                            type="button"
                            id="add-approval-3"
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded ml-2"
                            >
                            +
                            </button>
                        </div>
                        <div class="mb-2">
                            <label class="block text-gray-700 text-sm font-bold mb-2" for="jenis_group_3">
                                Jenis Group
                            </label>
                            <select
                                class="shadow border rounded w-full py-2 px-3 text-gray-700"
                                id="jenis_group_3"
                                name="jenis_group_3"
                                required
                            >
                                <option value="all" selected>Semua harus menyetujui</option>
                                <option value="any">Salah satu saja</option>
                            </select>
                        </div>

                        <div id="approval-container-3"></div>
                    </div>
                    <div class="w-full px-2 mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="komentar">
                            Komentar
                        </label>
                        <textarea
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="komentar"
                            name="komentar"
                            placeholder="Masukkan Komentar"
                            rows="4"
                        ></textarea>
                    </div>
                </div>
                <!-- Submit Button -->
                <div class="mt-4 flex justify-center">
                    <button
                        type="submit"
                        class="bg-[#038F87] hover:bg-[#1f7c77] text-white font-bold py-2 px-20 rounded-xl"
                    >
                        Kirim
                    </button>
                </div>
            </div>
        </form>
        </div>
    </div>

    <script src="https://unpkg.com/@feathersjs/client@^5.0.0/dist/feathers.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
   
        const userid = localStorage.getItem('userID');
        const IDDisplay = document.getElementById('id-user-display');
        if (userid && IDDisplay) {
            IDDisplay.textContent = `${userid}`;
        } else {
            IDDisplay.textContent = 'Guest';
        }

        const userName = localStorage.getItem('userName');
        // Get the element where you want to display the username
        const usernameDisplay = document.getElementById('username-display');
        // Set the content of the element
        if (userName && usernameDisplay) {
            usernameDisplay.textContent = `${userName}`;
        } else {
            usernameDisplay.textContent = 'Welcome, Guest!';
        }

        document.addEventListener('DOMContentLoaded', () => {
            let approvalCount = 1;
            let approvalCount2 = 1;
            let approvalCount3 = 1;

            document.getElementById('add-approval').addEventListener('click', () => {
                approvalCount++;
                const approvalContainer = document.getElementById('approval-container-1');

                const newApprovalDiv = document.createElement('div');
                newApprovalDiv.classList.add('w-full', 'flex', 'flex-wrap', 'px-2', 'mb-4');
                newApprovalDiv.innerHTML = `
                    <div class="w-full md:w-1/3 px-2 mb-4">
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="nama_approval_1_index_${approvalCount}"
                            name="nama_approval_1"
                            type="text"
                            placeholder="Masukkan Nama"
                            required
                        />
                    </div>
                    <div class="w-full md:w-1/3 px-2 mb-4">
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="email_approval_index_${approvalCount}"
                            name="email_approval_1"
                            type="email"
                            placeholder="Masukkan Email"
                            required
                        />
                    </div>
                    <div class="w-full md:w-1/3 px-2 mb-4">
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="jabatan_approval_index_${approvalCount}"
                            name="jabatan_approval_1"
                            type="text"
                            placeholder="Masukkan Jabatan"
                            required
                        />
                    </div>
                `;

                approvalContainer.appendChild(newApprovalDiv);

            });
            document.getElementById('add-approval-2').addEventListener('click', () => {
                approvalCount2++;
                const approvalContainer2 = document.getElementById('approval-container-2');

                const newApprovalDiv2 = document.createElement('div');
                newApprovalDiv2.classList.add('w-full', 'flex', 'flex-wrap', 'px-2', 'mb-4');
                newApprovalDiv2.innerHTML = `
                    <div class="w-full md:w-1/3 px-2 mb-4">
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="nama_approval_2_index_${approvalCount2}"
                            name="nama_approval_2"
                            type="text"
                            placeholder="Masukkan Nama"
                            required
                        />
                    </div>
                    <div class="w-full md:w-1/3 px-2 mb-4">
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="email_approval_2_index_${approvalCount2}"
                            name="email_approval_2"
                            type="email"
                            placeholder="Masukkan Email"
                            required
                        />
                    </div>
                    <div class="w-full md:w-1/3 px-2 mb-4">
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="jabatan_approval_index_${approvalCount}"
                            name="jabatan_approval_2"
                            type="text"
                            placeholder="Masukkan Jabatan"
                            required
                        />
                    </div>
                `;

                approvalContainer2.appendChild(newApprovalDiv2);
            });

            document.getElementById('add-approval-3').addEventListener('click', () => {
                approvalCount3++;
                const approvalContainer3 = document.getElementById('approval-container-3');

                const newApprovalDiv3 = document.createElement('div');
                newApprovalDiv3.classList.add('w-full', 'flex', 'flex-wrap', 'px-2', 'mb-4');
                newApprovalDiv3.innerHTML = `
                    <div class="w-full md:w-1/3 px-2 mb-4">
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="nama_approval_3_index_${approvalCount3}"
                            name="nama_approval_3"
                            type="text"
                            placeholder="Masukkan Nama"
                            required
                        />
                    </div>
                    <div class="w-full md:w-1/3 px-2 mb-4">
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="email_approval_3_index_${approvalCount3}"
                            name="email_approval_3"
                            type="email"
                            placeholder="Masukkan Email"
                            required
                        />
                    </div>
                    <div class="w-full md:w-1/3 px-2 mb-4">
                        <input
                            class="shadow border rounded w-full py-2 px-3 text-gray-700"
                            id="jabatan_approval_index_${approvalCount}"
                            name="jabatan_approval_3"
                            type="text"
                            placeholder="Masukkan Jabatan"
                            required
                        />
                    </div>
                `;

                approvalContainer3.appendChild(newApprovalDiv3);
            });

        });

        const fileInput = document.getElementById('file_dokumen'); 
        const uploadContent = document.getElementById('upload-content');

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                console.clear();
                console.log('Selected File Details:', {
                    id_multer: file.lastModified,
                    isi_file: file
                });
            }
        });

        fileInput.addEventListener('change', function() {
            if (fileInput.files.length > 0) {
                const fileName = fileInput.files[0].name;
                uploadContent.innerHTML = `
                    <p class="mb-2 text-sm text-gray-500">File terpilih:</p>
                    <p class="text-sm text-gray-700 mx-5">${fileName}</p>
                `;
            }
        });

        document.getElementById('upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();
            
            const fields = [
            'nomor_dokumen',
            'tgl_pengajuan',
            'tgl_deadline',
            'judul_dokumen',
            'jenis_group_1',
            'jenis_group_2',
            'jenis_group_3'
            ];
            
            fields.forEach(field => {
            formData.append(field, document.getElementById(field).value);
            });

            const fileInput = document.getElementById('file_dokumen');
            if (fileInput.files[0]) {
            formData.append('file_dokumen', fileInput.files[0]);
            }

            for (let i = 1; i <= 3; i++) {
            const namaField = document.getElementById(`nama_approval_${i}`);
            const emailField = document.getElementById(`email_approval_${i}`);
            const jabatanField = document.getElementById(`jabatan_approval_${i}`);
            
            if (namaField.value) {
                formData.append(`nama_approval_${i}`, namaField.value);
                formData.append(`email_approval_${i}`, emailField.value);
                formData.append(`jabatan_approval_${i}`, jabatanField.value);
            }
            }

            const token = localStorage.getItem('accessToken');
            if (!token) {
            console.error('No token found');
            return;
            }

            try {
            const response = await axios.post('http://localhost:3030/dokumen', formData, {
                headers: {
                'Content-Type': 'multipart/form-data',
                'Authorization': `Bearer ${token}`
                }
            });
            
            console.log('Upload successful:', response.data);
            } catch (error) {
            console.error('Upload failed:', error);
            }
        });
        
    </script>
</body>
</html>